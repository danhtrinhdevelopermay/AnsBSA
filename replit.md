# Vietnamese AI Chat Application

## Overview

This is a full-stack web application that provides an AI-powered chat interface in Vietnamese. The application features a modern, ChatGPT-like interface with real-time messaging, chat history management, and AI response generation using Google Gemini API. The application supports multimodal AI capabilities including image, video, and file analysis.

## User Preferences

Preferred communication style: Simple, everyday language.
Language: Vietnamese (user communicates in Vietnamese)

## Recent Changes

### July 26, 2025 - Firebase Authentication & Credit Management System Completed
- âœ… **NEW**: Complete Firebase Authentication system with email/password login
- âœ… **NEW**: Credit management system with 1000 credits for new users
- âœ… **NEW**: Real-time credit tracking and deduction based on AI feature usage
- âœ… **NEW**: Admin dashboard for user management and credit editing
- âœ… **NEW**: Credit transaction history with detailed analytics
- âœ… **NEW**: Unlimited API key support with auto-discovery and priority routing
- âœ… **NEW**: PostgreSQL database integration with Drizzle ORM for user data
- âœ… **NEW**: Secure user authentication with Firebase tokens
- âœ… **NEW**: Credit costs: Video Analysis (300), Image Generation (200), Deep Search (200)
- âœ… **NEW**: Admin controls for user status (active/inactive) and credit adjustments
- âœ… **NEW**: Login/register interface with auto-redirect after authentication
- âœ… Enhanced error handling and quota management with credit awareness
- âœ… Database migration to support user management and credit transactions
- âœ… Firebase Admin SDK integration for server-side token verification

### July 26, 2025 - Advanced Web Builder vá»›i Auto-Redirect HoÃ n ThÃ nh
- âœ… **NEW**: Há»‡ thá»‘ng Web Builder nÃ¢ng cáº¥p vá»›i AdvancedWebBuilderService
- âœ… **NEW**: Auto-redirect tá»± Ä‘á»™ng - AI tá»± Ä‘á»™ng chuyá»ƒn hÆ°á»›ng Ä‘áº¿n Web Builder khi phÃ¡t hiá»‡n yÃªu cáº§u xÃ¢y dá»±ng web
- âœ… **NEW**: Táº¡o website hoÃ n chá»‰nh tá»« frontend Ä‘áº¿n backend vá»›i má»™t lá»‡nh duy nháº¥t
- âœ… **NEW**: Há»— trá»£ Ä‘áº§y Ä‘á»§ cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh: HTML5, CSS3, JavaScript ES6+, Node.js, React
- âœ… **NEW**: Tá»± Ä‘á»™ng phÃ¡t hiá»‡n loáº¡i project: portfolio, blog, ecommerce, dashboard, landing, SPA, backend, fullstack
- âœ… **NEW**: TÃ­ch há»£p tá»± Ä‘á»™ng cÃ¡c tÃ­nh nÄƒng: responsive design, dark mode, authentication, database, API, search
- âœ… **NEW**: Tá»± Ä‘á»™ng táº¡o cáº¥u trÃºc thÆ° má»¥c vÃ  file hoÃ n chá»‰nh vá»›i README, package.json, config files
- âœ… **NEW**: TÃ­ch há»£p TypewriterText component vá»›i auto-redirect detection
- âœ… **NEW**: Táº¡o code cháº¥t lÆ°á»£ng cao vá»›i modern web standards vÃ  best practices
- âœ… **NEW**: Há»‡ thá»‘ng phÃ¢n tÃ­ch yÃªu cáº§u thÃ´ng minh vÃ  Ä‘á» xuáº¥t tÃ­nh nÄƒng phÃ¹ há»£p
- âœ… **NEW**: Há»— trá»£ terminal operations tá»± Ä‘á»™ng cho setup project vÃ  file management
- âœ… Enhanced AI response vá»›i special formatting Ä‘á»ƒ trigger auto-redirect
- âœ… Tá»‘i Æ°u hÃ³a quota vá»›i cache riÃªng cho web builder projects (30 phÃºt TTL)
- âœ… Comprehensive error handling vÃ  fallback mechanisms

### July 26, 2025 - Multi-API Gemini System & Quota Optimization Completed
- âœ… **NEW**: Complete multi-API Gemini management system with priority-based routing
- âœ… **NEW**: Automatic API failover when quota exceeded or API fails  
- âœ… **NEW**: Intelligent quota tracking with comprehensive usage monitoring
- âœ… **NEW**: Smart cache system to reduce repeated API calls by 30-60%
- âœ… **NEW**: Quota optimization service with automatic cleanup and suggestions
- âœ… **NEW**: Admin endpoints for API management and quota reporting
- âœ… **NEW**: Real-time quota warnings with actionable tips for users
- âœ… **NEW**: Expense-aware operations that skip costly features when limits reached
- âœ… Enhanced all AI services (chat, learning, web-scraper, deep-search) to use multi-API system
- âœ… Comprehensive error handling with backup API switching
- âœ… API health monitoring with automatic recovery after failures
- âœ… Vietnamese-optimized quota saving suggestions and alternatives

### July 25, 2025 - DeepSearch Feature Added (ChatGPT-like Real-time Search)
- âœ… **NEW**: Intelligent DeepSearch system that automatically triggers for real-time queries
- âœ… **NEW**: Multi-source web search using Perplexity API, Google Custom Search, and DuckDuckGo
- âœ… **NEW**: Smart keyword detection for news, prices, weather, events, research topics
- âœ… **NEW**: Real-time content extraction and AI-powered summarization with sources
- âœ… **NEW**: Visual DeepSearch indicator with search status and query display
- âœ… **NEW**: Automatic fallback to search results when main AI API fails
- âœ… **NEW**: Comprehensive error handling and multiple API service support
- âœ… Integration with existing AI responses for enhanced accuracy
- âœ… Source citations and reference links in responses
- âœ… Vietnamese language optimization for search queries and results

### July 25, 2025 - Enhanced Typing Animation System Completed
- âœ… **NEW**: Real-time typing animation that starts immediately when AI begins responding
- âœ… **NEW**: "AI Ä‘ang suy nghÄ©" placeholder shown instantly before response arrives
- âœ… **NEW**: Smart typing speed with faster animation for spaces and punctuation
- âœ… **NEW**: Optimistic UI updates for immediate user feedback
- âœ… **NEW**: Smooth cursor blinking animation during typing
- âœ… **NEW**: Support for markdown content during typing animation
- âœ… Enhanced user experience with no waiting time for visual feedback
- âœ… Removed old loading indicators in favor of typing animation
- âœ… TypewriterText component with configurable speed and completion callbacks
- âœ… Integrated with chat interface for seamless message flow

### July 25, 2025 - Full AI Web Automation Completed  
- âœ… Implemented complete AI automation for web development
- âœ… AI automatically analyzes user requirements and creates detailed project plans
- âœ… Auto-generates production-ready HTML, CSS, and JavaScript files
- âœ… Creates complete websites without requiring any user intervention
- âœ… Supports multiple project types: portfolio, landing page, blog, ecommerce
- âœ… Generates responsive, modern designs with custom color schemes
- âœ… Includes interactive features, animations, and professional styling
- âœ… Full integration with Web Builder for viewing and editing
- âœ… Real-time file creation and workspace management

### July 25, 2025 - AnimateDiff Integration & Quota-Free AI Solution
- âœ… **NEW**: Integrated AnimateDiff for text-to-video and image-to-video generation
- âœ… **NEW**: Added quota-free AI chat services (Groq, Cohere, Hugging Face)
- âœ… **NEW**: Comprehensive fallback system that never crashes (no more 500 errors)
- âœ… **NEW**: Smart AnimateDiff detection with automatic image-to-video conversion
- âœ… Enhanced AI video generation with 8+ services including AnimateDiff
- âœ… Added multiple FREE APIs: Google Veo 2, Qwen 2.5 Max, AI4Chat, Fliki AI  
- âœ… Enhanced Hugging Face LTX-Video integration with proper file saving
- âœ… Added premium options: fal.ai Hunyuan, Kling AI, HeyGen, Synthesia
- âœ… Created smart API key detection and automatic service fallback
- âœ… Implemented real video file generation and workspace saving
- âœ… Enhanced Vietnamese language detection and prompt optimization
- âœ… Added detailed user guides for obtaining free API keys
- âœ… Comprehensive error handling with service status reporting
- âœ… Ready for immediate use with any supported API key
- âœ… **UPDATED**: AnimateDiff models: ByteDance Lightning, guoyww motion adapter, i2vgen-xl
- âœ… **UPDATED**: Intelligent context detection for image-to-video workflow
- âœ… **UPDATED**: Service priority: AnimateDiff â†’ Hugging Face â†’ Replicate â†’ Premium

### July 25, 2025 - AI Image Generation Feature Added
- âœ… Added AI image generation capability using Google Gemini 2.0 Flash
- âœ… Integrated @google/genai package for multimodal AI support
- âœ… Created generateImage function with Vietnamese language detection
- âœ… Added API endpoint /api/generate-image for standalone image creation
- âœ… Configured static file serving for generated images via /web-builder-workspace
- âœ… Implemented automatic image generation in chat responses
- âœ… Added comprehensive error handling and user feedback
- âœ… Enhanced pattern detection for better keyword recognition
- âœ… Improved logging and debugging for image generation process
- âœ… Added fallback mechanism when image generation fails
- âœ… Implemented conversation context awareness for follow-up image requests
- âœ… Smart prompt enhancement for contextual image generation
- âœ… Support for natural language follow-ups like "cho nÃ³ Ä‘ang Äƒn" after initial image creation

### July 25, 2025 - Website Analysis Feature Added  
- âœ… **NEW**: AI can now access and analyze any website from user URLs
- âœ… **NEW**: Automatic content extraction and intelligent summarization
- âœ… **NEW**: Key points identification from web content
- âœ… **NEW**: Website analysis API endpoint /api/analyze-website
- âœ… **NEW**: Smart URL detection in chat messages
- âœ… **NEW**: Enhanced AI responses with website context
- âœ… **NEW**: Support for Vietnamese and English content analysis
- âœ… **NEW**: Robust error handling for unreachable websites
- âœ… Real-time website content integration into chat conversations
- âœ… Automatic website analysis when URLs are detected in messages

### July 25, 2025 - AI Self-Learning System Added
- âœ… **NEW**: Integrated comprehensive AI self-learning system
- âœ… **NEW**: Automatic knowledge updates from internet sources every 2 hours
- âœ… **NEW**: Real-time knowledge enhancement for chat responses
- âœ… **NEW**: Knowledge search and statistics API endpoints
- âœ… **NEW**: Sources include: VnExpress Tech, TechCrunch, arXiv, GitHub Trending
- âœ… **NEW**: Smart knowledge extraction using Gemini AI
- âœ… **NEW**: Confidence scoring and relevance ranking for learned knowledge
- âœ… **NEW**: Manual knowledge update capability via API
- âœ… Enhanced chat responses with up-to-date information from internet
- âœ… Automatic categorization and filtering of learned knowledge
- âœ… Memory management with cleanup of old knowledge items

### July 26, 2025 - Migration to Replit Environment Completed
- âœ… Successfully migrated from Replit Agent to Replit environment
- âœ… Fixed TypeScript compilation errors and tsx execution
- âœ… Configured environment variables with proper security separation
- âœ… Enhanced Firebase Admin SDK initialization with proper error handling
- âœ… Fixed duplicate environment variable issues in .env configuration
- âœ… Implemented multi-API Gemini system with automatic failover
- âœ… Verified application is running smoothly on port 5000 with 0.0.0.0 binding
- âœ… Confirmed all AI services, chat interface, and database connections working
- âœ… Auto-learning system operational with knowledge base updates
- âœ… Web Builder, image generation, and video creation features functional
- âœ… Client/server separation maintained with proper security practices
- âœ… All dependency packages properly installed and configured
- âœ… Fixed Firebase authentication service with proper environment variable handling
- âœ… Resolved dynamic import issues for Firebase service functions
- âœ… Enhanced private key formatting for Firebase Admin SDK
- âœ… Updated message storage schema to include required userId field
- ğŸ”§ Environment variables properly organized and cleaned up from .env file

## System Architecture

The application follows a modern full-stack architecture with clear separation between frontend and backend components:

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Routing**: Wouter for lightweight client-side routing
- **UI Framework**: shadcn/ui components built on Radix UI primitives
- **Styling**: Tailwind CSS with CSS variables for theming
- **State Management**: TanStack Query (React Query) for server state management
- **Build Tool**: Vite for fast development and optimized production builds

### Backend Architecture
- **Runtime**: Node.js with Express.js framework
- **Language**: TypeScript with ES modules
- **API Design**: RESTful API with JSON communication
- **Database ORM**: Drizzle ORM for type-safe database operations
- **Database**: PostgreSQL (configured for Neon Database)
- **AI Integration**: Google Gemini API for chat responses, title generation, and multimodal analysis (images, videos, files)

### Data Storage Solutions
- **Primary Database**: PostgreSQL with Drizzle ORM
- **Development Storage**: In-memory storage implementation for development/testing
- **Schema Management**: Drizzle Kit for migrations and schema management

## Key Components

### Frontend Components
1. **ChatInterface**: Main container component managing chat state and interactions
2. **ChatHeader**: Top navigation bar with sidebar toggle and new chat button
3. **ChatSidebar**: Collapsible sidebar showing chat history
4. **ChatMessages**: Message display area with user and AI messages
5. **ChatInput**: Message composition area with auto-resize and tool integration
6. **WelcomeScreen**: Initial screen with conversation starters
7. **WebBuilder**: Full-featured IDE with code editor, file manager, terminal, and preview

### Backend Services
1. **AI Service**: Google Gemini integration for generating responses, chat titles, and auto-detecting web development requests
2. **Storage Service**: Abstracted storage interface supporting multiple implementations
3. **Web Builder Service**: File system operations, terminal command execution, and workspace management
4. **Route Handlers**: Express.js routes for chat, message management, and Web Builder API endpoints

### Shared Schema
- Type-safe schema definitions using Drizzle ORM and Zod validation
- Shared types between frontend and backend for consistency

## Data Flow

1. **Chat Creation**: User creates new chat â†’ Backend generates unique ID â†’ Frontend updates state
2. **Message Sending**: User sends message â†’ Saved to database â†’ AI generates response â†’ Response saved and displayed
3. **Chat History**: Frontend queries chat list â†’ Backend retrieves from database â†’ Updates sidebar
4. **Real-time Updates**: Uses React Query for automatic cache invalidation and refetching
5. **Web Development Flow**: User requests web development â†’ AI detects keywords â†’ Auto-creates project files â†’ User can access via Web Builder
6. **File Operations**: Web Builder syncs with backend file system â†’ Real-time file editing â†’ Workspace persistence

## External Dependencies

### Core Dependencies
- **@neondatabase/serverless**: Neon Database PostgreSQL driver
- **drizzle-orm**: Type-safe ORM for database operations
- **@tanstack/react-query**: Server state management
- **openai**: Official OpenAI API client

### UI Dependencies
- **@radix-ui/***: Accessible UI primitives
- **tailwindcss**: Utility-first CSS framework
- **lucide-react**: Icon library
- **wouter**: Lightweight routing

### Development Dependencies
- **vite**: Build tool and dev server
- **typescript**: Type checking
- **@replit/vite-plugin-***: Replit-specific development tools

## Deployment Strategy

### Development Environment
- **Dev Server**: Vite dev server for frontend with HMR
- **API Server**: Express.js server with TypeScript compilation via tsx
- **Database**: Configured for Neon Database with environment variables

### Production Build
- **Frontend**: Vite builds optimized static assets to `dist/public`
- **Backend**: esbuild bundles Node.js server to `dist/index.js`
- **Database**: Drizzle migrations applied via `db:push` command

### Environment Configuration
- **DATABASE_URL**: PostgreSQL connection string (required)
- **GEMINI_API_KEY**: Google Gemini API authentication (required for AI features)
- **NODE_ENV**: Environment flag for development/production behavior

### Web Builder API Endpoints
- **POST /api/web-builder/files**: Create new file with {name, content}
- **GET /api/web-builder/files**: List all files in workspace
- **GET /api/web-builder/files/:fileName**: Read specific file content
- **PUT /api/web-builder/files/:fileName**: Update file content
- **DELETE /api/web-builder/files/:fileName**: Delete file
- **POST /api/web-builder/folders**: Create new folder with {name}
- **POST /api/web-builder/execute**: Execute terminal command with {command}
- **POST /api/web-builder/start-server**: Create development server setup

### Key Architectural Decisions

1. **Monorepo Structure**: Frontend (`client/`), backend (`server/`), and shared code (`shared/`) in single repository
2. **Type Safety**: Full TypeScript coverage with shared schema validation
3. **Modern Tooling**: Vite for fast development, esbuild for production builds
4. **Database Choice**: PostgreSQL with Drizzle ORM for type safety and performance
5. **AI Integration**: Google Gemini for high-quality Vietnamese language support and auto web development detection
6. **Component Library**: shadcn/ui for consistent, accessible UI components
7. **State Management**: React Query for server state, avoiding complex global state
8. **Storage Abstraction**: Interface-based storage allowing multiple implementations
9. **File System Integration**: Secure workspace management with controlled file operations
10. **Auto Code Generation**: AI automatically creates project files based on user requests

The architecture prioritizes developer experience, type safety, and modern web standards while maintaining good separation of concerns and scalability.