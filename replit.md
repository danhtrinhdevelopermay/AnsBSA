# Vietnamese AI Chat Application

## Overview

This is a full-stack web application that provides an AI-powered chat interface in Vietnamese. The application features a modern, ChatGPT-like interface with real-time messaging, chat history management, and AI response generation using Google Gemini API. The application supports multimodal AI capabilities including image, video, and file analysis.

## User Preferences

Preferred communication style: Simple, everyday language.
Language: Vietnamese (user communicates in Vietnamese)

## Recent Changes

### July 26, 2025 - Firebase Authentication & Credit Management System Completed
- ✅ **NEW**: Complete Firebase Authentication system with email/password login
- ✅ **NEW**: Credit management system with 1000 credits for new users
- ✅ **NEW**: Real-time credit tracking and deduction based on AI feature usage
- ✅ **NEW**: Admin dashboard for user management and credit editing
- ✅ **NEW**: Credit transaction history with detailed analytics
- ✅ **NEW**: Unlimited API key support with auto-discovery and priority routing
- ✅ **NEW**: PostgreSQL database integration with Drizzle ORM for user data
- ✅ **NEW**: Secure user authentication with Firebase tokens
- ✅ **NEW**: Credit costs: Video Analysis (300), Image Generation (200), Deep Search (200)
- ✅ **NEW**: Admin controls for user status (active/inactive) and credit adjustments
- ✅ **NEW**: Login/register interface with auto-redirect after authentication
- ✅ Enhanced error handling and quota management with credit awareness
- ✅ Database migration to support user management and credit transactions
- ✅ Firebase Admin SDK integration for server-side token verification

### July 26, 2025 - Advanced Web Builder với Auto-Redirect Hoàn Thành
- ✅ **NEW**: Hệ thống Web Builder nâng cấp với AdvancedWebBuilderService
- ✅ **NEW**: Auto-redirect tự động - AI tự động chuyển hướng đến Web Builder khi phát hiện yêu cầu xây dựng web
- ✅ **NEW**: Tạo website hoàn chỉnh từ frontend đến backend với một lệnh duy nhất
- ✅ **NEW**: Hỗ trợ đầy đủ các ngôn ngữ lập trình: HTML5, CSS3, JavaScript ES6+, Node.js, React
- ✅ **NEW**: Tự động phát hiện loại project: portfolio, blog, ecommerce, dashboard, landing, SPA, backend, fullstack
- ✅ **NEW**: Tích hợp tự động các tính năng: responsive design, dark mode, authentication, database, API, search
- ✅ **NEW**: Tự động tạo cấu trúc thư mục và file hoàn chỉnh với README, package.json, config files
- ✅ **NEW**: Tích hợp TypewriterText component với auto-redirect detection
- ✅ **NEW**: Tạo code chất lượng cao với modern web standards và best practices
- ✅ **NEW**: Hệ thống phân tích yêu cầu thông minh và đề xuất tính năng phù hợp
- ✅ **NEW**: Hỗ trợ terminal operations tự động cho setup project và file management
- ✅ Enhanced AI response với special formatting để trigger auto-redirect
- ✅ Tối ưu hóa quota với cache riêng cho web builder projects (30 phút TTL)
- ✅ Comprehensive error handling và fallback mechanisms

### July 26, 2025 - Multi-API Gemini System & Quota Optimization Completed
- ✅ **NEW**: Complete multi-API Gemini management system with priority-based routing
- ✅ **NEW**: Automatic API failover when quota exceeded or API fails  
- ✅ **NEW**: Intelligent quota tracking with comprehensive usage monitoring
- ✅ **NEW**: Smart cache system to reduce repeated API calls by 30-60%
- ✅ **NEW**: Quota optimization service with automatic cleanup and suggestions
- ✅ **NEW**: Admin endpoints for API management and quota reporting
- ✅ **NEW**: Real-time quota warnings with actionable tips for users
- ✅ **NEW**: Expense-aware operations that skip costly features when limits reached
- ✅ Enhanced all AI services (chat, learning, web-scraper, deep-search) to use multi-API system
- ✅ Comprehensive error handling with backup API switching
- ✅ API health monitoring with automatic recovery after failures
- ✅ Vietnamese-optimized quota saving suggestions and alternatives

### July 25, 2025 - DeepSearch Feature Added (ChatGPT-like Real-time Search)
- ✅ **NEW**: Intelligent DeepSearch system that automatically triggers for real-time queries
- ✅ **NEW**: Multi-source web search using Perplexity API, Google Custom Search, and DuckDuckGo
- ✅ **NEW**: Smart keyword detection for news, prices, weather, events, research topics
- ✅ **NEW**: Real-time content extraction and AI-powered summarization with sources
- ✅ **NEW**: Visual DeepSearch indicator with search status and query display
- ✅ **NEW**: Automatic fallback to search results when main AI API fails
- ✅ **NEW**: Comprehensive error handling and multiple API service support
- ✅ Integration with existing AI responses for enhanced accuracy
- ✅ Source citations and reference links in responses
- ✅ Vietnamese language optimization for search queries and results

### July 25, 2025 - Enhanced Typing Animation System Completed
- ✅ **NEW**: Real-time typing animation that starts immediately when AI begins responding
- ✅ **NEW**: "AI đang suy nghĩ" placeholder shown instantly before response arrives
- ✅ **NEW**: Smart typing speed with faster animation for spaces and punctuation
- ✅ **NEW**: Optimistic UI updates for immediate user feedback
- ✅ **NEW**: Smooth cursor blinking animation during typing
- ✅ **NEW**: Support for markdown content during typing animation
- ✅ Enhanced user experience with no waiting time for visual feedback
- ✅ Removed old loading indicators in favor of typing animation
- ✅ TypewriterText component with configurable speed and completion callbacks
- ✅ Integrated with chat interface for seamless message flow

### July 25, 2025 - Full AI Web Automation Completed  
- ✅ Implemented complete AI automation for web development
- ✅ AI automatically analyzes user requirements and creates detailed project plans
- ✅ Auto-generates production-ready HTML, CSS, and JavaScript files
- ✅ Creates complete websites without requiring any user intervention
- ✅ Supports multiple project types: portfolio, landing page, blog, ecommerce
- ✅ Generates responsive, modern designs with custom color schemes
- ✅ Includes interactive features, animations, and professional styling
- ✅ Full integration with Web Builder for viewing and editing
- ✅ Real-time file creation and workspace management

### July 25, 2025 - AnimateDiff Integration & Quota-Free AI Solution
- ✅ **NEW**: Integrated AnimateDiff for text-to-video and image-to-video generation
- ✅ **NEW**: Added quota-free AI chat services (Groq, Cohere, Hugging Face)
- ✅ **NEW**: Comprehensive fallback system that never crashes (no more 500 errors)
- ✅ **NEW**: Smart AnimateDiff detection with automatic image-to-video conversion
- ✅ Enhanced AI video generation with 8+ services including AnimateDiff
- ✅ Added multiple FREE APIs: Google Veo 2, Qwen 2.5 Max, AI4Chat, Fliki AI  
- ✅ Enhanced Hugging Face LTX-Video integration with proper file saving
- ✅ Added premium options: fal.ai Hunyuan, Kling AI, HeyGen, Synthesia
- ✅ Created smart API key detection and automatic service fallback
- ✅ Implemented real video file generation and workspace saving
- ✅ Enhanced Vietnamese language detection and prompt optimization
- ✅ Added detailed user guides for obtaining free API keys
- ✅ Comprehensive error handling with service status reporting
- ✅ Ready for immediate use with any supported API key
- ✅ **UPDATED**: AnimateDiff models: ByteDance Lightning, guoyww motion adapter, i2vgen-xl
- ✅ **UPDATED**: Intelligent context detection for image-to-video workflow
- ✅ **UPDATED**: Service priority: AnimateDiff → Hugging Face → Replicate → Premium

### July 25, 2025 - AI Image Generation Feature Added
- ✅ Added AI image generation capability using Google Gemini 2.0 Flash
- ✅ Integrated @google/genai package for multimodal AI support
- ✅ Created generateImage function with Vietnamese language detection
- ✅ Added API endpoint /api/generate-image for standalone image creation
- ✅ Configured static file serving for generated images via /web-builder-workspace
- ✅ Implemented automatic image generation in chat responses
- ✅ Added comprehensive error handling and user feedback
- ✅ Enhanced pattern detection for better keyword recognition
- ✅ Improved logging and debugging for image generation process
- ✅ Added fallback mechanism when image generation fails
- ✅ Implemented conversation context awareness for follow-up image requests
- ✅ Smart prompt enhancement for contextual image generation
- ✅ Support for natural language follow-ups like "cho nó đang ăn" after initial image creation

### July 25, 2025 - Website Analysis Feature Added  
- ✅ **NEW**: AI can now access and analyze any website from user URLs
- ✅ **NEW**: Automatic content extraction and intelligent summarization
- ✅ **NEW**: Key points identification from web content
- ✅ **NEW**: Website analysis API endpoint /api/analyze-website
- ✅ **NEW**: Smart URL detection in chat messages
- ✅ **NEW**: Enhanced AI responses with website context
- ✅ **NEW**: Support for Vietnamese and English content analysis
- ✅ **NEW**: Robust error handling for unreachable websites
- ✅ Real-time website content integration into chat conversations
- ✅ Automatic website analysis when URLs are detected in messages

### July 25, 2025 - AI Self-Learning System Added
- ✅ **NEW**: Integrated comprehensive AI self-learning system
- ✅ **NEW**: Automatic knowledge updates from internet sources every 2 hours
- ✅ **NEW**: Real-time knowledge enhancement for chat responses
- ✅ **NEW**: Knowledge search and statistics API endpoints
- ✅ **NEW**: Sources include: VnExpress Tech, TechCrunch, arXiv, GitHub Trending
- ✅ **NEW**: Smart knowledge extraction using Gemini AI
- ✅ **NEW**: Confidence scoring and relevance ranking for learned knowledge
- ✅ **NEW**: Manual knowledge update capability via API
- ✅ Enhanced chat responses with up-to-date information from internet
- ✅ Automatic categorization and filtering of learned knowledge
- ✅ Memory management with cleanup of old knowledge items

### July 26, 2025 - Migration to Replit Environment Completed
- ✅ Successfully migrated from Replit Agent to Replit environment
- ✅ Fixed TypeScript compilation errors and tsx execution
- ✅ Configured environment variables with proper security separation
- ✅ Enhanced Firebase Admin SDK initialization with proper error handling
- ✅ Fixed duplicate environment variable issues in .env configuration
- ✅ Implemented multi-API Gemini system with automatic failover
- ✅ Verified application is running smoothly on port 5000 with 0.0.0.0 binding
- ✅ Confirmed all AI services, chat interface, and database connections working
- ✅ Auto-learning system operational with knowledge base updates
- ✅ Web Builder, image generation, and video creation features functional
- ✅ Client/server separation maintained with proper security practices
- ✅ All dependency packages properly installed and configured
- ✅ Fixed Firebase authentication service with proper environment variable handling
- ✅ Resolved dynamic import issues for Firebase service functions
- ✅ Enhanced private key formatting for Firebase Admin SDK
- ✅ Updated message storage schema to include required userId field
- 🔧 Environment variables properly organized and cleaned up from .env file

## System Architecture

The application follows a modern full-stack architecture with clear separation between frontend and backend components:

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Routing**: Wouter for lightweight client-side routing
- **UI Framework**: shadcn/ui components built on Radix UI primitives
- **Styling**: Tailwind CSS with CSS variables for theming
- **State Management**: TanStack Query (React Query) for server state management
- **Build Tool**: Vite for fast development and optimized production builds

### Backend Architecture
- **Runtime**: Node.js with Express.js framework
- **Language**: TypeScript with ES modules
- **API Design**: RESTful API with JSON communication
- **Database ORM**: Drizzle ORM for type-safe database operations
- **Database**: PostgreSQL (configured for Neon Database)
- **AI Integration**: Google Gemini API for chat responses, title generation, and multimodal analysis (images, videos, files)

### Data Storage Solutions
- **Primary Database**: PostgreSQL with Drizzle ORM
- **Development Storage**: In-memory storage implementation for development/testing
- **Schema Management**: Drizzle Kit for migrations and schema management

## Key Components

### Frontend Components
1. **ChatInterface**: Main container component managing chat state and interactions
2. **ChatHeader**: Top navigation bar with sidebar toggle and new chat button
3. **ChatSidebar**: Collapsible sidebar showing chat history
4. **ChatMessages**: Message display area with user and AI messages
5. **ChatInput**: Message composition area with auto-resize and tool integration
6. **WelcomeScreen**: Initial screen with conversation starters
7. **WebBuilder**: Full-featured IDE with code editor, file manager, terminal, and preview

### Backend Services
1. **AI Service**: Google Gemini integration for generating responses, chat titles, and auto-detecting web development requests
2. **Storage Service**: Abstracted storage interface supporting multiple implementations
3. **Web Builder Service**: File system operations, terminal command execution, and workspace management
4. **Route Handlers**: Express.js routes for chat, message management, and Web Builder API endpoints

### Shared Schema
- Type-safe schema definitions using Drizzle ORM and Zod validation
- Shared types between frontend and backend for consistency

## Data Flow

1. **Chat Creation**: User creates new chat → Backend generates unique ID → Frontend updates state
2. **Message Sending**: User sends message → Saved to database → AI generates response → Response saved and displayed
3. **Chat History**: Frontend queries chat list → Backend retrieves from database → Updates sidebar
4. **Real-time Updates**: Uses React Query for automatic cache invalidation and refetching
5. **Web Development Flow**: User requests web development → AI detects keywords → Auto-creates project files → User can access via Web Builder
6. **File Operations**: Web Builder syncs with backend file system → Real-time file editing → Workspace persistence

## External Dependencies

### Core Dependencies
- **@neondatabase/serverless**: Neon Database PostgreSQL driver
- **drizzle-orm**: Type-safe ORM for database operations
- **@tanstack/react-query**: Server state management
- **openai**: Official OpenAI API client

### UI Dependencies
- **@radix-ui/***: Accessible UI primitives
- **tailwindcss**: Utility-first CSS framework
- **lucide-react**: Icon library
- **wouter**: Lightweight routing

### Development Dependencies
- **vite**: Build tool and dev server
- **typescript**: Type checking
- **@replit/vite-plugin-***: Replit-specific development tools

## Deployment Strategy

### Development Environment
- **Dev Server**: Vite dev server for frontend with HMR
- **API Server**: Express.js server with TypeScript compilation via tsx
- **Database**: Configured for Neon Database with environment variables

### Production Build
- **Frontend**: Vite builds optimized static assets to `dist/public`
- **Backend**: esbuild bundles Node.js server to `dist/index.js`
- **Database**: Drizzle migrations applied via `db:push` command

### Environment Configuration
- **DATABASE_URL**: PostgreSQL connection string (required)
- **GEMINI_API_KEY**: Google Gemini API authentication (required for AI features)
- **NODE_ENV**: Environment flag for development/production behavior

### Web Builder API Endpoints
- **POST /api/web-builder/files**: Create new file with {name, content}
- **GET /api/web-builder/files**: List all files in workspace
- **GET /api/web-builder/files/:fileName**: Read specific file content
- **PUT /api/web-builder/files/:fileName**: Update file content
- **DELETE /api/web-builder/files/:fileName**: Delete file
- **POST /api/web-builder/folders**: Create new folder with {name}
- **POST /api/web-builder/execute**: Execute terminal command with {command}
- **POST /api/web-builder/start-server**: Create development server setup

### Key Architectural Decisions

1. **Monorepo Structure**: Frontend (`client/`), backend (`server/`), and shared code (`shared/`) in single repository
2. **Type Safety**: Full TypeScript coverage with shared schema validation
3. **Modern Tooling**: Vite for fast development, esbuild for production builds
4. **Database Choice**: PostgreSQL with Drizzle ORM for type safety and performance
5. **AI Integration**: Google Gemini for high-quality Vietnamese language support and auto web development detection
6. **Component Library**: shadcn/ui for consistent, accessible UI components
7. **State Management**: React Query for server state, avoiding complex global state
8. **Storage Abstraction**: Interface-based storage allowing multiple implementations
9. **File System Integration**: Secure workspace management with controlled file operations
10. **Auto Code Generation**: AI automatically creates project files based on user requests

The architecture prioritizes developer experience, type safety, and modern web standards while maintaining good separation of concerns and scalability.